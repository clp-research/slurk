

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>4. Pairing up participants and running multiple rooms &mdash; slurk 8310fb15326fc43b4db8bf2ddcade571f3b11bcb documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. Layouts and Plugins" href="slurk_layouts.html" />
    <link rel="prev" title="3. Getting Started" href="slurk_gettingstarted.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> slurk
          

          
          </a>

          
            
            
              <div class="version">
                8310fb15326fc43b4db8bf2ddcade571f3b11bcb
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="slurk_about.html">1. Slurk: What’s this?</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_prerequisites.html">2. Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_gettingstarted.html">3. Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Pairing up participants and running multiple rooms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">4.1. Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-a-waiting-room-and-a-task">4.2. Create a waiting room and a task</a></li>
<li class="toctree-l2"><a class="reference internal" href="#assign-bots-to-rooms">4.3. Assign bots to rooms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-user-tokens-for-the-task">4.4. Create user tokens for the task</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="slurk_layouts.html">5. Layouts and Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_permission.html">6. Security and Permissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_bots.html">7. Writing your own bots</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_api.html">8. REST API for slurk</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_deployment.html">9. Deployment of the system</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_amt.html">10. Getting participants from Amazon Mechanical Turk</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">slurk</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">4. </span>Pairing up participants and running multiple rooms</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/slurk_multibots.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pairing-up-participants-and-running-multiple-rooms">
<span id="slurk-multibots"></span><h1><span class="section-number">4. </span>Pairing up participants and running multiple rooms<a class="headerlink" href="#pairing-up-participants-and-running-multiple-rooms" title="Permalink to this headline">¶</a></h1>
<p>In the following steps you will learn how to let bots and human users enter the slurk waiting room where users will be
paired up and put into a new task-specific chatroom along with bots. We provided an example bot handling this mechanism:
The <strong>concierge bot</strong> moves human users and other bots from the waiting room to a taskroom.</p>
<div class="section" id="prerequisites">
<h2><span class="section-number">4.1. </span>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Install the <code class="docutils literal notranslate"><span class="pre">jq</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install jq
</pre></div>
</div>
<p>Start the server if it’s not running already (it might ask for your computer’s password):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">source</span> scripts/start_slurk_server.sh
$ <span class="nb">source</span> scripts/get_admin_token.sh
</pre></div>
</div>
<p>Check your admin token, you may need it later when running bots in different shells:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">echo</span> <span class="nv">$ADMIN_TOKEN</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-waiting-room-and-a-task">
<h2><span class="section-number">4.2. </span>Create a waiting room and a task<a class="headerlink" href="#create-a-waiting-room-and-a-task" title="Permalink to this headline">¶</a></h2>
<p>First of all, we need a waiting room and a task. For the waiting room, we submit the layout. Let’s take the layout
provided in the slurk-bots repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl https://raw.githubusercontent.com/clp-research/slurk-bots/master/concierge/layout.json &gt; waiting_room_layout.json
</pre></div>
</div>
<p>This layout now has to be pushed to the server:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">WAITING_ROOM_LAYOUT</span><span class="o">=</span><span class="k">$(</span>sh scripts/push_room_layout.sh <span class="nv">$ADMIN_TOKEN</span> waiting_room_layout.json<span class="k">)</span>
</pre></div>
</div>
<p>Ensure we have a valid id (should not be empty):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">echo</span> <span class="nv">$WAITING_ROOM_LAYOUT</span>
</pre></div>
</div>
<p>We can now create the waiting room with the associated layout:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sh scripts/create_room_with_layout.sh <span class="nv">$ADMIN_TOKEN</span> waiting_room <span class="s2">&quot;Waiting Room&quot;</span> <span class="nv">$WAITING_ROOM_LAYOUT</span>
</pre></div>
</div>
<p>The next step is to create a task. Each task contains information about the number of users required in order to start
the task:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">source</span> scripts/create_task.sh <span class="nv">$ADMIN_TOKEN</span> <span class="s2">&quot;Echo Task&quot;</span> <span class="m">2</span>
$ <span class="nb">echo</span> <span class="nv">$TASK_ID</span>
</pre></div>
</div>
</div>
<div class="section" id="assign-bots-to-rooms">
<h2><span class="section-number">4.3. </span>Assign bots to rooms<a class="headerlink" href="#assign-bots-to-rooms" title="Permalink to this headline">¶</a></h2>
<p>Each bot needs a token in order to be run.
The token for the concierge bot is stored in <code class="docutils literal notranslate"><span class="pre">CONCIERGE_BOT_TOKEN</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">CONCIERGE_BOT_TOKEN</span><span class="o">=</span><span class="k">$(</span>sh scripts/create_token.sh <span class="nv">$ADMIN_TOKEN</span> waiting_room --concierge<span class="k">)</span>
$ <span class="nb">echo</span> <span class="nv">$CONCIERGE_BOT_TOKEN</span>
</pre></div>
</div>
<p>The token for the echo bot is stored in <code class="docutils literal notranslate"><span class="pre">ECHO_BOT_TOKEN</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">ECHO_BOT_TOKEN</span><span class="o">=</span><span class="k">$(</span>sh scripts/create_token.sh <span class="nv">$ADMIN_TOKEN</span> waiting_room --echo<span class="k">)</span>
$ <span class="nb">echo</span> <span class="nv">$ECHO_BOT_TOKEN</span>
</pre></div>
</div>
<p>Open two new terminals and copy <code class="docutils literal notranslate"><span class="pre">CONCIERGE_BOT_TOKEN</span></code> to one terminal and <code class="docutils literal notranslate"><span class="pre">ECHO_BOT_TOKEN</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">TASK_ID</span></code> to another terminal.
Now start the concierge bot using the token you just created from the new terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker run -e <span class="nv">TOKEN</span><span class="o">=</span><span class="nv">$CONCIERGE_BOT_TOKEN</span> --net<span class="o">=</span><span class="s2">&quot;host&quot;</span> slurk/concierge-bot
</pre></div>
</div>
<p>The concierge bot is joining the waiting room now. It waits for two users to join the waiting room, who both have the
specified task assigned. Once both have joined, the bot will create a new task room and move both users into that room.
We want the echo bot to join this task room as well. The concierge bot emits two events when creating a new task room:
<code class="docutils literal notranslate"><span class="pre">new_room</span></code> and <code class="docutils literal notranslate"><span class="pre">new_task_room</span></code>.</p>
<p>The echo bot is able to listen to those events. This bot has an optional <code class="docutils literal notranslate"><span class="pre">ECHO_TASK_ID</span></code> parameter, to listen to specific tasks to join. Let’s start it
from the new terminal that contains the echo bot token:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker run -e <span class="nv">TOKEN</span><span class="o">=</span><span class="nv">$ECHO_BOT_TOKEN</span> -e <span class="nv">ECHO_TASK_ID</span><span class="o">=</span><span class="nv">$TASK_ID</span> --net<span class="o">=</span><span class="s2">&quot;host&quot;</span> slurk/echo-bot
</pre></div>
</div>
</div>
<div class="section" id="create-user-tokens-for-the-task">
<h2><span class="section-number">4.4. </span>Create user tokens for the task<a class="headerlink" href="#create-user-tokens-for-the-task" title="Permalink to this headline">¶</a></h2>
<p>Now let’s create two user tokens from the original terminal (run the command twice) and specify the task:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sh scripts/create_token_for_task.sh <span class="nv">$ADMIN_TOKEN</span> waiting_room <span class="nv">$TASK_ID</span>
</pre></div>
</div>
<p>Open two browsers or two private tabs, log in with two different tokens and wait for the concierge bot to move both
users to a new room. The echo bot will also join this room and reply to every chat message.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="slurk_layouts.html" class="btn btn-neutral float-right" title="5. Layouts and Plugins" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="slurk_gettingstarted.html" class="btn btn-neutral float-left" title="3. Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017-2018 DSG Bielefeld, 2019 CL Potsdam.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>