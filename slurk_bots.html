

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>7. Writing your own bots &mdash; slurk e6f2cec1ffed6073f9e82140637537f00aaf0c95 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="8. REST API for slurk" href="slurk_api.html" />
    <link rel="prev" title="6. Security and Permissions" href="slurk_permission.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> slurk
          

          
          </a>

          
            
            
              <div class="version">
                e6f2cec1ffed6073f9e82140637537f00aaf0c95
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="slurk_about.html">1. Slurk: What’s this?</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_prerequisites.html">2. Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_gettingstarted.html">3. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_multibots.html">4. Pairing up participants and running multiple rooms</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_layouts.html">5. Layouts and Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_permission.html">6. Security and Permissions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">7. Writing your own bots</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dissecting-the-concierge-bot">7.1. Dissecting the concierge bot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#joining-newly-created-task-rooms">7.2. Joining newly created task rooms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interacting-with-layouts">7.3. Interacting with layouts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#messages">7.4. Messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#commands">7.5. Commands</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="slurk_api.html">8. REST API for slurk</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_deployment.html">9. Deployment of the system</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurk_amt.html">10. Getting participants from Amazon Mechanical Turk</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">slurk</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">7. </span>Writing your own bots</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/slurk_bots.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="writing-your-own-bots">
<span id="slurk-bots"></span><h1><span class="section-number">7. </span>Writing your own bots<a class="headerlink" href="#writing-your-own-bots" title="Permalink to this headline">¶</a></h1>
<p>Bots are little client programs, which can both communicate with human clients and the server. By sending commands and responding to socket events they can perform various actions, e.g. sending messages, changing images shown to human clients, connecting clients to task rooms and handling dialogue tasks. Defining an experimental or data collection setting typically includes writing one or multiple bots.</p>
<p>There are some sample bots provided as examples, two of which are dissected and explained below.</p>
<div class="section" id="dissecting-the-concierge-bot">
<h2><span class="section-number">7.1. </span>Dissecting the concierge bot<a class="headerlink" href="#dissecting-the-concierge-bot" title="Permalink to this headline">¶</a></h2>
<p>The concierge bot is an example for a bot able to group up users and move them into a newly created room.</p>
<p>The bot has to be started with a valid token and optionally with a server URL and Port. <code class="docutils literal notranslate"><span class="pre">args</span></code> are parameters to the
bot itself and consists of a host, a port, and a token. For authorization the token has to be provided in the headers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">socketIO</span> <span class="o">=</span> <span class="n">SocketIO</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">chat_host</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">chat_port</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="s1">&#39;Concierge Bot&#39;</span><span class="p">},</span>
                    <span class="n">Namespace</span><span class="o">=</span><span class="n">ChatNamespace</span><span class="p">)</span>
</pre></div>
</div>
<p>If the connection was successful, the bot connects to the <code class="docutils literal notranslate"><span class="pre">ChatNamespace</span></code>. From now on it listens to the events
emitted by the server. Listening on events is straight forward with adding new methods to the <code class="docutils literal notranslate"><span class="pre">ChatNamespace</span></code> class.</p>
<p>The bot has to be notified when a user joins or leaves the room:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Called on `status` events</span>
<span class="k">def</span> <span class="nf">on_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
    <span class="c1"># We are interested in &quot;join&quot; and &quot;leave&quot; events.</span>
    <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;join&#39;</span><span class="p">:</span>
        <span class="c1"># Get the user, who has joined a room</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>
        <span class="c1"># Read the task associated with the user</span>
        <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_task</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">task</span><span class="p">:</span>
            <span class="c1"># Join the task, if any</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_task_join</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;room&#39;</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;leave&#39;</span><span class="p">:</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>
        <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_task</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">task</span><span class="p">:</span>
            <span class="c1"># Leave the task as the user is not present anymore.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_task_leave</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>


<span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_user_task</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="c1"># REST call to the server.</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uri</span><span class="si">}</span><span class="s2">/user/</span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/task&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Token </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">task</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not get user task&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># Return the task as dictionary</span>
    <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">user_task_join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">room</span><span class="p">):</span>
    <span class="n">task_id</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
    <span class="n">user_name</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

    <span class="c1"># Check if the bot is already aware if this task. If not create it</span>
    <span class="k">if</span> <span class="n">task_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># The tasks are determined by the `task_id` and the `user_id`. We store the room, where the user is present.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_id</span><span class="p">][</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">room</span>

    <span class="c1"># If we reach the required user for the task, move those users into a new task room.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_id</span><span class="p">])</span> <span class="o">==</span> <span class="n">task</span><span class="p">[</span><span class="s1">&#39;num_users&#39;</span><span class="p">]:</span>
        <span class="c1"># First of all, create a new task room</span>
        <span class="n">new_room</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_room</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">task</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">])</span>
        <span class="c1"># Notify the server, that the room was created, thus bots can join this room as well.</span>
        <span class="c1"># This is needed as separate step, as the socketio interface is not connected to the REST API.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;room_created&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;room&#39;</span><span class="p">:</span> <span class="n">new_room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="n">task_id</span><span class="p">},</span> <span class="bp">self</span><span class="o">.</span><span class="n">room_created_feedback</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">user</span><span class="p">,</span> <span class="n">old_room</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_id</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Let every user join the new room and leave the old one.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;join_room&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span> <span class="s1">&#39;room&#39;</span><span class="p">:</span> <span class="n">new_room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]},</span> <span class="bp">self</span><span class="o">.</span><span class="n">join_room_feedback</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;leave_room&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span> <span class="s1">&#39;room&#39;</span><span class="p">:</span> <span class="n">old_room</span><span class="p">},</span> <span class="bp">self</span><span class="o">.</span><span class="n">leave_room_feedback</span><span class="p">)</span>
        <span class="c1"># clear the task as the users are now moved. This shouldn&#39;t be necessary, but let&#39;s stay conservative.</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">[</span><span class="n">task_id</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If we don&#39;t have enough users for a task, send the new user a message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Hello, </span><span class="si">{</span><span class="n">user_name</span><span class="si">}</span><span class="s1">! I am looking for a partner for you, it might take some &#39;</span>
                           <span class="s1">&#39;time, so be patient, please...&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;receiver_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                           <span class="s1">&#39;room&#39;</span><span class="p">:</span> <span class="n">room</span><span class="p">},</span> <span class="n">message_response</span><span class="p">)</span>
</pre></div>
</div>
<p>In order to verify emits, a callback is provided to every call. Every callback is invoked with a success flag as the
first argument and an error message as second argument, if the success flag is <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">join_room_feedback</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not join room:&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;user joined room&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">leave_room_feedback</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not leave room:&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;user left room&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">room_created_feedback</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not create task room:&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;task room created&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="joining-newly-created-task-rooms">
<h2><span class="section-number">7.2. </span>Joining newly created task rooms<a class="headerlink" href="#joining-newly-created-task-rooms" title="Permalink to this headline">¶</a></h2>
<p>When the concierge bot creates a new room, it will move the assigned user to this room. In order to join those task
rooms as bot, they may listen to the <code class="docutils literal notranslate"><span class="pre">new_task_room</span></code> event just like the echo bot:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_new_task_room</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;task&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">TASK_ID</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s2">&quot;join_room&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;room&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;room&#39;</span><span class="p">]})</span>
</pre></div>
</div>
<p>At the point where a task room has been opened, it compares the task id of the task room with the specified id and joins
the room.</p>
</div>
<div class="section" id="interacting-with-layouts">
<h2><span class="section-number">7.3. </span>Interacting with layouts<a class="headerlink" href="#interacting-with-layouts" title="Permalink to this headline">¶</a></h2>
<p>Bots can modify layouts in two ways: Setting texts and altering attribute values.</p>
<p>For this, four events are provided:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">set_attribute</span></code>: Sets a javascript attribute to a new value. Those are the fields, which may be passed:</dt><dd><ul>
<li><code class="docutils literal notranslate"><span class="pre">attribute</span></code>: The attribute to be updated</li>
<li><code class="docutils literal notranslate"><span class="pre">value</span></code>: The value to be set for the given attribute</li>
<li><code class="docutils literal notranslate"><span class="pre">id</span></code> (Optional): The id of the element, which is going to be updated</li>
<li><code class="docutils literal notranslate"><span class="pre">class</span></code> (Optional): The class of the element, which is going to be updated</li>
<li><code class="docutils literal notranslate"><span class="pre">element</span></code> (Optional): The element type, which is going to be updated. Either <code class="docutils literal notranslate"><span class="pre">id</span></code>, <code class="docutils literal notranslate"><span class="pre">class</span></code> or <code class="docutils literal notranslate"><span class="pre">element</span></code> is required.</li>
<li><code class="docutils literal notranslate"><span class="pre">receiver_id</span></code> (Optional): Sends the attribute to this receiver only</li>
<li><code class="docutils literal notranslate"><span class="pre">room</span></code> (Optional): Sends the attribute to this room. Either <code class="docutils literal notranslate"><span class="pre">receiver_id</span></code> or <code class="docutils literal notranslate"><span class="pre">room</span></code> is required</li>
<li><code class="docutils literal notranslate"><span class="pre">sender_id</span></code> (Optional): The sender of the message. Defaults to the current user</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">set_text</span></code>: Sets a html text element  by id to a new value. Those are the fields, which may be passed:</dt><dd><ul>
<li><code class="docutils literal notranslate"><span class="pre">id</span></code>: The id of the text element, which is going to be updated</li>
<li><code class="docutils literal notranslate"><span class="pre">text</span></code>: The text to be set</li>
<li><code class="docutils literal notranslate"><span class="pre">receiver_id</span></code> (Optional): Sends the text to this receiver only</li>
<li><code class="docutils literal notranslate"><span class="pre">room</span></code> (Optional): Sends the text to this room. Either <code class="docutils literal notranslate"><span class="pre">receiver_id</span></code> or <code class="docutils literal notranslate"><span class="pre">room</span></code> is required</li>
<li><code class="docutils literal notranslate"><span class="pre">sender_id</span></code> (Optional): The sender of the message. Defaults to the current user</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">add_class</span></code>: Adds the html class to an element by id. Those are the fields, which may be passed:</dt><dd><ul>
<li><code class="docutils literal notranslate"><span class="pre">id</span></code>: The id of the element, which is going to be updated</li>
<li><code class="docutils literal notranslate"><span class="pre">text</span></code>: The class to be added</li>
<li><code class="docutils literal notranslate"><span class="pre">receiver_id</span></code> (Optional): Adds the class for this receiver only</li>
<li><code class="docutils literal notranslate"><span class="pre">room</span></code> (Optional): Adds the class for all receivers in this room. Either <code class="docutils literal notranslate"><span class="pre">receiver_id</span></code> or <code class="docutils literal notranslate"><span class="pre">room</span></code> is required</li>
<li><code class="docutils literal notranslate"><span class="pre">sender_id</span></code> (Optional): The sender of the message. Defaults to the current user</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">remove_class</span></code>: Removes the html class from an element by id. Those are the fields, which may be passed:</dt><dd><ul>
<li><code class="docutils literal notranslate"><span class="pre">id</span></code>: The id of the element, which is going to be updated</li>
<li><code class="docutils literal notranslate"><span class="pre">text</span></code>: The class to be removed</li>
<li><code class="docutils literal notranslate"><span class="pre">receiver_id</span></code> (Optional): Removes the class for this receiver only</li>
<li><code class="docutils literal notranslate"><span class="pre">room</span></code> (Optional): Removes the class for all receivers in this room. Either <code class="docutils literal notranslate"><span class="pre">receiver_id</span></code> or <code class="docutils literal notranslate"><span class="pre">room</span></code> is required</li>
<li><code class="docutils literal notranslate"><span class="pre">sender_id</span></code> (Optional): The sender of the message. Defaults to the current user</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>If you want to change an image for example, you may use something like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="s1">&#39;set_attribute&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="s1">&#39;room&#39;</span><span class="p">:</span> <span class="n">room</span><span class="p">,</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span>
  <span class="s1">&#39;attribute&#39;</span><span class="p">:</span> <span class="s2">&quot;src&quot;</span><span class="p">,</span>
  <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="messages">
<h2><span class="section-number">7.4. </span>Messages<a class="headerlink" href="#messages" title="Permalink to this headline">¶</a></h2>
<p>Bots can listen to messages with <code class="docutils literal notranslate"><span class="pre">on_text_message</span></code> and <code class="docutils literal notranslate"><span class="pre">on_image_message</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_text_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">do_something</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">data</span></code> in <code class="docutils literal notranslate"><span class="pre">on_text_message</span></code> has this structure:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">message</span></code>: the text, which was sent</li>
<li><code class="docutils literal notranslate"><span class="pre">user</span></code>: dictionary of <code class="docutils literal notranslate"><span class="pre">id</span></code> and <code class="docutils literal notranslate"><span class="pre">name</span></code> of the user, who submitted the command</li>
<li><code class="docutils literal notranslate"><span class="pre">room</span></code>: the id of the room, where the command was entered, or <code class="docutils literal notranslate"><span class="pre">None</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">private</span></code>: <code class="docutils literal notranslate"><span class="pre">True</span></code> if this is a private message like direct messages. <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise</li>
<li><code class="docutils literal notranslate"><span class="pre">timestamp</span></code></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_image_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">do_something</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">data</span></code> in <code class="docutils literal notranslate"><span class="pre">on_image_message</span></code> has this structure:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">url</span></code>: URL of the image to display</li>
<li><code class="docutils literal notranslate"><span class="pre">user</span></code>: dictionary of <code class="docutils literal notranslate"><span class="pre">id</span></code> and <code class="docutils literal notranslate"><span class="pre">name</span></code> of the user, who submitted the command</li>
<li><code class="docutils literal notranslate"><span class="pre">room</span></code>: the id of the room, where the command was entered, or <code class="docutils literal notranslate"><span class="pre">None</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">width</span></code>: the recommended width of the image</li>
<li><code class="docutils literal notranslate"><span class="pre">height</span></code>: the recommended height of the image</li>
<li><code class="docutils literal notranslate"><span class="pre">private</span></code>: <code class="docutils literal notranslate"><span class="pre">True</span></code> if this is a private message like direct messages. <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise</li>
<li><code class="docutils literal notranslate"><span class="pre">timestamp</span></code></li>
</ul>
</div>
<div class="section" id="commands">
<h2><span class="section-number">7.5. </span>Commands<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h2>
<p>Commands are very similar to text message, but requires a dedicated permission. Commands are sent to a room and a bot
can listen to a command with <code class="docutils literal notranslate"><span class="pre">on_command</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">do_something</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">data</span></code> has this structure:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">command</span></code>: the sent command</li>
<li><code class="docutils literal notranslate"><span class="pre">user</span></code>: dictionary of <code class="docutils literal notranslate"><span class="pre">id</span></code> and <code class="docutils literal notranslate"><span class="pre">name</span></code> of the user, who submitted the command</li>
<li><code class="docutils literal notranslate"><span class="pre">room</span></code>: the id of the room, where the command was entered, or <code class="docutils literal notranslate"><span class="pre">None</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">timestamp</span></code></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="slurk_api.html" class="btn btn-neutral float-right" title="8. REST API for slurk" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="slurk_permission.html" class="btn btn-neutral float-left" title="6. Security and Permissions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017-2018 DSG Bielefeld, 2019 CL Potsdam.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>